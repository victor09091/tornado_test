<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="ajax方式">
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <title>注册</title>
    <script>

       function myFunction(){
           var x=document.getElementById("email").value;
	       var atpos=x.indexOf("@");
	       var dotpos=x.lastIndexOf(".");
	       if (atpos<1 || dotpos<atpos+2 || dotpos+2>=x.length) {
               alert("不是一个有效的 e-mail 地址");
               return false;
           }
           console.log("hello");
	       var username = $('#name').val();
           var email = $('#email').val();
	       $.ajax({
            //几个参数需要注意一下

                type: "POST",//方法类型
                dataType: "json",//预期服务器返回的数据类型
                url: "/send_email" ,//url
                data: {username: username, email:email},
//                data: $('#form1').serialize(),

                success: function (result) {
//                    console.log(result);//打印服务端返回的数据(调试用)
                    if (result.resultCode == 200) {
                        alert("SUCCESS");
                    };
                },
//                error : function() {
//                    alert("异常！");
//                }
           });
	       alert("你好，邮件验证码开始发送，请稍后查看！");
        }
    </script>
    <script type="text/javascript">
    var name;
    var email;
    var password;
    var authcode;
//    function do_checking()
//    {
//        name = document.getElementById("name").value;
//        email = document.getElementById("email").value;
//        password = document.getElementById("password").value;
//        if(!name || !email || !password)
//        {
//            alert("请输入完整的信息");
//        }
//
//    }

    function register() {
           var username = $('#name').val();
           var email = $('#email').val();
           var password = $('#password').val();
           var authcode = $('#authcode').val();
               $.ajax({
                   //几个参数需要注意一下
                   type: "post",//方法类型
                   dataType: "json",//预期服务器返回的数据类型
                   url: "/register",//url
                   data: {username: username, email: email, password: password, authcode: authcode},
                   success: function (result) {
                       alert("Data Saved: " + result);
                       console.log(result);//打印服务端返回的数据(调试用)
                       if (result.resultCode == 200) {
                           alert("SUCCESS");
                       }
                       ;
                   },
                   error: function () {
                       alert("异常！");
                   }
               });
    }
    </script>
</head>
<body>
    <!--<form action="/register" method="post" id="form1">-->
    <form id="form1" onsubmit="return false" action="##" method="post">

        <p>用户名: <input type="text" name="username" id="name"> </p>
        <p>密码: <input type="password" name="password" id="password"> </p>
        <p>邮箱: <input type="email" name="email" id="email">
            <input type="button" onclick="myFunction()" value="发送验证码"/>
        </p>
        <p>邮件验证码: <input type="text" name="email_check_code" id="authcode"> </p>
        <p><input type="submit" value="点击注册" onclick="register()"></p>
        <!--<div>-->
            <!--<button type="submit" id="submit" onclick="do_checking()">点击注册</button>-->
        <!--</div>-->

    </form>
</body>
</html>